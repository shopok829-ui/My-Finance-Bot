<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; text-align: center; padding: 20px; }
        .box { background: white; padding: 30px; border-radius: 10px; max-width: 400px; margin: 0 auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        button { background: #25D366; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; width: 100%; }
        button:disabled { background: #ccc; }
        #log { margin-top: 20px; background: #222; color: #0f0; padding: 10px; height: 150px; overflow-y: auto; text-align: left; font-family: monospace; font-size: 12px; border-radius: 5px; direction: ltr; }
        #qr-img { max-width: 100%; margin-top: 10px; display: none; border: 1px solid #ddd; }
        .status { margin: 15px 0; font-weight: bold; color: #555; }
        .success { color: #008000; display: none; font-size: 18px; border: 2px solid #008000; padding: 10px; border-radius: 10px; background: #eaffea; }
        .loading { color: #dda005; display: none; font-size: 16px; margin-top: 10px;}
    </style>
</head>
<body>
    <div class="box">
        <h2>ğŸ¤– Ø¨ÙˆØª Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h2>
        <button id="btn" onclick="start()">ğŸš€ ØªØ´ØºÙŠÙ„ / Ø±Ø¨Ø·</button>
        
        <div id="status-text" class="status">Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø£Ù…Ø±...</div>
        
        <div id="loading-msg" class="loading">
            ğŸ” ØªÙ… Ø§Ù„Ù…Ø³Ø­ Ø¨Ù†Ø¬Ø§Ø­!<br>Ø¬Ø§Ø±ÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„Ø³ÙŠØ±ÙØ±...<br>â³ Ø§Ù†ØªØ¸Ø± Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©
        </div>

        <div id="success-msg" class="success">âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„!</div>
        
        <img id="qr-img" src="">
        <div id="log">Logs will appear here...</div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const logDiv = document.getElementById('log');
        const qrImg = document.getElementById('qr-img');
        const btn = document.getElementById('btn');
        const successMsg = document.getElementById('success-msg');
        const loadingMsg = document.getElementById('loading-msg');
        const statusText = document.getElementById('status-text');

        function start() {
            btn.disabled = true;
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...";
            socket.emit('start_session');
        }

        socket.on('log', (msg) => {
            const div = document.createElement('div');
            div.textContent = '> ' + msg;
            logDiv.appendChild(div);
            logDiv.scrollTop = logDiv.scrollHeight;
        });

        socket.on('qr', (url) => {
            successMsg.style.display = 'none';
            loadingMsg.style.display = 'none';
            qrImg.style.display = 'block';
            qrImg.src = url;
            statusText.innerText = "Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø¢Ù†";
            btn.style.display = 'none';
        });

        // ğŸŸ¡ Ø¹Ù†Ø¯ Ù†Ø¬Ø§Ø­ Ø§Ù„Ù…Ø³Ø­ ÙˆÙ‚Ø¨Ù„ Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
        socket.on('authenticated', () => {
            qrImg.style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
            loadingMsg.style.display = 'block'; // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
            statusText.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...";
        });

        // ğŸŸ¢ Ø¹Ù†Ø¯ Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„ØªØ§Ù…Ø©
        socket.on('ready', () => {
            qrImg.style.display = 'none';
            loadingMsg.style.display = 'none';
            successMsg.style.display = 'block';
            statusText.innerText = "Ù…ØªØµÙ„";
            btn.style.display = 'none';
        });
    </script>
</body>
</html>
